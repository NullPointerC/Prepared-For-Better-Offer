### 能说说什么是索引吗？索引的种类的有哪些？

索引(Index)是帮助数据库高效获取数据的数据结构。索引是在基于数据库表创建的，它包含一个表中某些列的值以及记录对应的地址，并且把这些值存储在一个数据结构中。

最常见的就是使用哈希表、B+树作为索引，项目中我们使用InnoDB引擎，默认的是B+树。

### 什么情况下适合建索引？

—般来说，在WHERE和JOIN中出现的列需要建立索引，因为MySQL只对<，<=，=，>，>=，BETWEEN，IN，以及某些时候的LIKE才会使用索引(以通配符%和_开头作查询时，MySQL不会使用索引)。通常会根据慢查询日志来优化SQL以及判断是否建索引。

### 你们在创建索引的时候会考虑哪些因素？

在日常工作中，我们会通过开慢查询去记录一些执行时间比较久的SQL语句，我们公司慢查询阀值是500ms，找出这些SQL语句后，我们用到explain命令来查看这些SQL语句的执行计划，查看该SQL语句有没有使用上索引，有没有做全表扫描。

把查询条件中没有建立索引的列创建索引。

### 在创建联合索引时，你是怎样考虑多个字段之间的顺序的?

在创建多列索引时，我们根据业务需求, where子句中使用最频繁的一列放在最左边，因为MySQL索引查询会遵循最左前缀匹配的原则，即最左优先，在检索数据时从联合索引的最左边开始匹配。所以当我们创建一个联合索引的时候，如(key1,key2,key3)，相当于创建了(key1)，(key1,key2)和(key1,key2,key3)三个索引，这就是最左匹配原则。

### 为什么会使用B+树?

由于索引是存在于磁盘中，当索引非常大的时候，比如达到几个G的时候，无法一次加载到内存中，所以数据库中索引使用的是查找效率更高的树形结构。B+树是平衡多路查找树，是为磁盘等外存储设备设计的一种平衡查找树。

系统从磁盘读取数据到内存时是以磁盘块(block)为基本单位的，位于同一个磁盘块中的数据会被一次性读取出来，InnoDB存储引擎中有页(Page)的概念，页是其磁盘管理的最小单位。InnoDB存储引擎中默认每个页的大小为16KB，可通过参数innodb_page_size设置页的大小，InnoDB在把磁盘数据读入到磁盘时会以页为基本单位，在查询数据时如果一个页中的每条数据都能有助于定位数据记录的位置，这将会减少磁盘I/O次数，提高查询效率。

B＋树使用有序数组链表＋平衡多叉树改良了B树的有序数组+平衡多叉树;

B+树的关键字全部存放在叶子节点中，非叶子节点用来做索引，而叶子节点中有一个指针指向一下个叶子节点。做这个优化的目的是为了提高区间访问的性能。

数据库索引采用B+树的主要原因是B树在提高了磁盘IO性能的同时并没有解决元素遍历效率低下的问题。正是为了解决这个问题，B+树应运而生。B+树只要遍历叶子节点就可以实现整棵树的遍历。而且在数据库中基于范围的查询是非常频繁的，也是B+树的优势所在。

### 和Hash索引比较起来有什么优缺点吗?

哈希索引适合等值查询，但是无法进行范围查询;哈希索引没办法利用索引完成排序;哈希索引不支持多列联合索引的最左匹配规则;如果有大量重复键值的情况下，哈希索引的效率会很低，可能存在哈希碰撞问题。

### B+树的叶子节点都可以存哪些东西?

InnoDB的B+树可能存储的是整行数据，也有可能是主键的值，索引B+树的叶子节点存储了整行数据的是主键索引，也被称之为聚簇索引。而索引B+树的叶子节点存储了主键的值的是非主键索引，也被称之为非聚簇索引。

### 聚簇索引和非聚簇索引，在查询数据的时候有区别吗?

主键索引查询只会查一次，而非主键索引需要回表查询多次，通过覆盖索引也可以只查询一次，覆盖索引指一个查询语句的执行只用从索引中就能够取得，不必从数据表中读取。

MySQL只需要通过索引就可以返回查询所需要的数据，这样避免了查到索引后再返回表操作，减少I/O提高效率。

聚集索引（聚簇索引)∶以 InnoDB作为存储引擎的表，表中的数据都会有一个主键,
即使你不创建主键,系统也会帮你创建一个隐式的主键。

非聚集索引(非聚簇索引)︰以主键以外的列值作为键值构建的B+树索引，我们称之为非聚集索引。

### 有没有对于查询做一些优化呢?在哪些方面优化?

分库分表

![image-20220309201508312](https://gitee.com/cao_ziqiang/img/raw/master/20220309201508.png)

